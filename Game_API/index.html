<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="style.css">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <div id="branding">
            <h1>Time Clash Cronicles</h1>
            </div>
            <nav>
               <ul>
        <li><a href="#Timeclash">Que es?</a></li>
        <li><a href="#jugar">Jugar</a></li>
        <li><a href="#Estadisticas">Estadisticas</a></li>
    </ul>


            </nav>
        </div>
    </header>
    <main>
    <section id="Timeclash">
        <div class="pop-out-box">
            <div class="container">
                <h1>Time Clash Chronicles!</h1>
                <p>Es un juego de cartas estratégico donde personajes históricos de diferentes países luchan en una arena. Cada mazo representa una nación con sus propias fortalezas, debilidades y líder. El objetivo es reducir la vida del líder enemigo a 0, derrotando su ejército representado por cartas. </p>

                
            </div>
        </div>
    </section>

    <section id="newsletter">
        <div class="container">
            <h2>Reglas del Juego:</h2>
            <h3>
                <div class="popup-content">
                <div class="separacion-divs">
                    Cada jugador tiene un líder que comienza con 
                    4000 puntos de vida. Durante el juego, los 
                    jugadores deben gestionar sus recursos, tanto 
                    las cartas de su mazo como las monedas de oro,
                     para tomar decisiones estratégicas en cada turno.
                </div>
                <div class="separacion-divs">
                    Las cartas pueden tener habilidades especiales, 
                    como provocar, cargar o robar cartas adicionales, 
                    lo que añade una capa adicional de estrategia al 
                    juego. Además, algunos mazos pueden tener sinergias
                     entre las cartas, lo que fomenta la creación de 
                     estrategias específicas.
                </div>
                <div class="separacion-divs">
                    La partida termina cuando uno de los líderes alcanza
                     0 puntos de vida, lo que lleva a la victoria del 
                     otro jugador. Sin embargo, la partida también puede
                      terminar si un jugador se queda sin cartas en su 
                      mazo y no puede robar más, lo que resulta en su
                       derrota.
                </div>
                <div class="separacion-divs">
                    Con estas mecánicas, el juego fomenta la planificación
                     a largo plazo, la adaptabilidad y la toma de decisiones 
                     rápidas, convirtiéndolo en un desafío estratégico
                      emocionante para los jugadores.
                </div>
            </div>

            <section id="jugar">   
            </h3>
            <h1>Jugar Time Clash Chronicles!</h1>
            </section>

            <section id="Estadisticas">
                <div class="container">
                    <h2>Estadisticas: Time Clash Chronicles</h2>
                    <div class="chart-container">

                        <div class="chart" id="winrate-pie-chart">
                            <h2>Winrate</h2>
                            <div id="winrate-chart"></div>
                        </div>
                
                   
                        <div class="chart" id="best-decks-bar-chart">
                            <h2>Winrate % by deck</h2>
                            <div id="best-decks-chart"></div>
                        </div>
                
                
                        <div class="chart" id="most-used-decks-bar-chart">
                            <h2>Most Used Decks</h2>
                            <div id="most-used-decks-chart"></div>
                        </div>
                    </div>
                    <p></p>
                </div>
            </section>
            

    </main>

    <footer>
        <p> TC2005 &copy; Copyright 2021</p>
    </footer>
    <script>
        google.charts.load('current', {packages: ['corechart', 'bar']});
        google.charts.setOnLoadCallback(drawCharts);

        function drawCharts() {
            // Fetch data from the winrate endpoint and create a pie chart
            fetch("http://127.0.0.1:5000/api/player/winrate")
                .then(response => {
                    console.log(response);
                    return response.json();
                })
                .then(data => {
                    console.log(data);
                    const winratePercentage = parseFloat(data.winrate).toFixed(2); 
                    const winrateData = google.visualization.arrayToDataTable([
                        ['Winrate', 'Percentage'],
                        ['Winrate', parseFloat(winratePercentage)], 
                        ['Loss rate', 100 - parseFloat(winratePercentage)] 
                    ]);
                    const winrateChart = new google.visualization.PieChart(document.getElementById('winrate-chart'));
                    winrateChart.draw(winrateData, {
                    });
                })
                .catch(error => {
                    console.error('Error fetching winrate:', error);
                });

            // Fetch data from the best decks endpoint and create a bar chart
            fetch("http://127.0.0.1:5000/api/game/bestdecks")
                .then(response => {
                    console.log(response);
                    return response.json();
                })
                .then(data => {
                    console.log(data);
                    const decks = data.map(deck => deck.name);
                    const victories = data.map(deck => parseFloat(deck.porcentaje_victoria).toFixed(2)); // Extract porcentaje_victoria from the response and parse value as float
                    const bestDecksData = google.visualization.arrayToDataTable([
                        ['Deck', 'Victories'],
                        ...decks.map((deck, index) => [deck, parseFloat(victories[index])]) // Parse value as float
                    ]);
                    const bestDecksChart = new google.visualization.BarChart(document.getElementById('best-decks-chart'));
                    bestDecksChart.draw(bestDecksData, {
                        legend: { position: 'none' }
                    });
                })
                .catch(error => {
                    console.error('Error fetching best decks:', error);
                });

            // Fetch data from the most used decks endpoint and create a bar chart
            fetch("http://127.0.0.1:5000/api/game/mostusedecks")
                .then(response => {
                    console.log(response);
                    return response.json();
                })
                .then(data => {
                    console.log(data);
                    const decks = data.map(deck => deck.Deck);
                    const counts = data.map(deck => parseInt(deck.top_deck)); // Parse value as integer
                    const mostUsedDecksData = google.visualization.arrayToDataTable([
                        ['Deck', 'Top Deck Count'],
                        ...decks.map((deck, index) => [deck, counts[index]])
                    ]);
                    const mostUsedDecksChart = new google.visualization.BarChart(document.getElementById('most-used-decks-chart'));
                    mostUsedDecksChart.draw(mostUsedDecksData, {
                        legend: { position: 'none' }
                    });
                })
                .catch(error => {
                    console.error('Error fetching most used decks:', error);
                });
        }
    </script>
</body>
</html>